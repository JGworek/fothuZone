<div class="container-fluid position-absolute overlay bg-light-fothu">
	<div class="row">
		<div class="col-12">
			<br />
			<br />
			<br />
			<div class="container-fluid">
				<!-- make text numbers hidden if the pet's user id does not match yours -->
				<!-- make buttons hidden if the pet's user id does not match yours -->
				<div class="row">
					<div
						[ngClass]="{ 'col-12 col-md-4 battle-pets bg-dark-fothu rounded': true, 'order-last': this.userService.currentUser.id == this.battleService.currentBattle.defendingUser.id }"
						[ngStyle]="{
							'box-shadow':
								(this.battleService.currentBattle.attackingUser.id == this.battleService.currentBattle.currentTurnPet.owner.id && !this.battleService.currentBattle.battleFinished) || (this.battleService.currentBattle.winningPet.owner.id == this.battleService.currentBattle.attackingUser.id && this.battleService.currentBattle.battleFinished)
									? '0px 0px 70px ' + this.battleService.currentBattle.attackingUser.favoriteColor
									: ''
						}"
					>
						<div *ngIf="!this.battleService.currentBattle.attackingPet.id">
							<div class="petcenter" [ngStyle]="{ visibility: this.battleService.currentBattle.attackingUser.id == this.userService.currentUser.id && !this.battleService.currentBattle.attackingPet.id ? 'hidden' : 'visible' }">
								<br />
								<br />
								<br />
								<h4 class="text-white">{{ this.battleService.currentBattle.attackingUser.username }} is still selecting a pet.</h4>
							</div>
							<div class="petcenter" [ngStyle]="{ visibility: this.battleService.currentBattle.attackingUser.id == this.userService.currentUser.id && !this.battleService.currentBattle.attackingPet.id ? 'visible' : 'hidden' }">
								<br />
								<div class="row">
									<div class="col-12">
										<h4 class="text-white">Select your figher:</h4>
										<br />
										<br />
										<br />
									</div>
									<div class="col-4" *ngFor="let pet of userService.currentUser.pets">
										<button
											[ngClass]="{ 'btn text-white mx-1': true, ' btn-success-fothu bg-success-fothu': (this.battleService.currentBattle.battleType == 'pvp' || pet.currentHealth) > 0, 'btn-light-fothu bg-light-fothu disabled': this.battleService.currentBattle.battleType == 'pve' && pet.currentHealth == 0 }"
											(click)="this.battleService.setAttackingPVPPet(this.battleService.currentBattle.id, pet.id)"
										>
											{{ pet.name }}
										</button>
									</div>
									<br />
									<br />
									<br />
								</div>
							</div>
						</div>
						<div *ngIf="this.battleService.currentBattle.attackingPet.id">
							<br />
							<h4 class="text-white">{{ this.battleService.currentBattle.attackingPet.name }}</h4>
							<br />
							<div class="d-none d-xl-block">
								<div [ngClass]="['big-pet-background img-responsive center-block mx-auto petcenter', this.battleService.currentBattle.attackingUser.favoriteColor]">
									<img class="big-pet-image" [src]="this.battleService.currentBattle.attackingPet.image.imageURL" [alt]="this.battleService.currentBattle.attackingPet.name" />
								</div>
							</div>
							<div class="d-block d-xl-none">
								<div [ngClass]="['medium-pet-background img-responsive center-block mx-auto petcenter', this.battleService.currentBattle.attackingUser.favoriteColor]">
									<img class="medium-pet-image" [src]="this.battleService.currentBattle.attackingPet.image.imageURL" [alt]="this.battleService.currentBattle.attackingPet.name" />
								</div>
							</div>
							<div class="d-none d-xl-block">
								<div class="progress border border-dark wrapper big-pet-battle-health-bar mx-auto">
									<div
										[class]="userService.getHealthBarColor(((this.battleService.currentBattle.attackingPetCurrentHealth / this.battleService.currentBattle.attackingPet.maxHealth) * 100).toFixed(0))"
										[ngStyle]="{ width: ((this.battleService.currentBattle.attackingPetCurrentHealth / this.battleService.currentBattle.attackingPet.maxHealth) * 100).toFixed(0) + '%', 'font-size': 'small', color: 'black', height: '50px' }"
									></div>
									<h4 class="big-data" [ngStyle]="{ visibility: this.battleService.currentBattle.attackingUser.id == this.userService.currentUser.id ? 'visible' : 'hidden' }">{{ this.battleService.currentBattle.attackingPetCurrentHealth }}/{{ this.battleService.currentBattle.attackingPet.maxHealth }} HP</h4>
								</div>
							</div>
							<div class="d-block d-xl-none">
								<div class="progress border border-dark wrapper medium-pet-battle-health-bar mx-auto">
									<div
										[class]="userService.getHealthBarColor(((this.battleService.currentBattle.attackingPetCurrentHealth / this.battleService.currentBattle.attackingPet.maxHealth) * 100).toFixed(0))"
										[ngStyle]="{ width: ((this.battleService.currentBattle.attackingPetCurrentHealth / this.battleService.currentBattle.attackingPet.maxHealth) * 100).toFixed(0) + '%', 'font-size': 'small', color: 'black', height: '50px' }"
									></div>
									<h4 class="big-data" [ngStyle]="{ visibility: this.battleService.currentBattle.attackingUser.id == this.userService.currentUser.id ? 'visible' : 'hidden' }">{{ this.battleService.currentBattle.attackingPetCurrentHealth }}/{{ this.battleService.currentBattle.attackingPet.maxHealth }} HP</h4>
								</div>
							</div>
							<br />
							<div class="action-buttons" [ngStyle]="{ visibility: this.battleService.currentBattle.attackingUser.id == this.userService.currentUser.id && this.battleService.currentBattle.currentTurnPet.id == this.battleService.currentBattle.attackingPet.id ? 'visible' : 'hidden' }">
								<div class="btn-group-vertical btn-group-lg m-1">
									<button class="btn btn-secondary-fothu bg-secondary-fothu battle-button text-white m-1" (click)="this.battleService.attack(this.battleService.currentBattle.id, this.battleService.currentBattle.attackingPet.id)">Attack</button>
									<button class="btn btn-primary battle-button m-1" (click)="this.battleService.aim(this.battleService.currentBattle.id, this.battleService.currentBattle.attackingPet.id)">Aim</button>
								</div>
								<div class="btn-group-vertical btn-group-lg m-1">
									<button class="btn btn-danger battle-button text-white m-1" (click)="this.battleService.defend(this.battleService.currentBattle.id, this.battleService.currentBattle.attackingPet.id)">Defend</button>
									<button class="btn btn-success battle-button m-1" (click)="this.battleService.sharpen(this.battleService.currentBattle.id, this.battleService.currentBattle.attackingPet.id)">Sharpen</button>
								</div>
							</div>
							<br />
							<div class="row" [ngStyle]="{ visibility: this.battleService.currentBattle.attackingUser.id == this.userService.currentUser.id ? 'visible' : 'hidden' }">
								<div class="col-4 text-white">Armor</div>
								<div class="col-4 text-white">Accuracy</div>
								<div class="col-4 text-white">Attack</div>
							</div>
							<div class="row" [ngStyle]="{ visibility: this.battleService.currentBattle.attackingUser.id == this.userService.currentUser.id ? 'visible' : 'hidden' }">
								<div class="col-4 text-white">{{ this.battleService.currentBattle.attackingPetCurrentArmorModifier }}x</div>
								<div class="col-4 text-white">{{ this.battleService.currentBattle.attackingPetCurrentAccuracyModifier }}x</div>
								<div class="col-4 text-white">{{ this.battleService.currentBattle.attackingPetCurrentAttackModifier }}x</div>
							</div>
							<br />
						</div>
					</div>
					<div class="col-12 col-md-4 battle-pets">
						<h4>&nbsp;</h4>
						<div *ngIf="!this.battleService.currentBattle.attackingPet.id || !this.battleService.currentBattle.defendingPet.id">
							<hr />
							<br />
							<h4>Waiting for 1 or more user to select a pet for battle.</h4>
							<hr />
						</div>
						<div *ngIf="this.battleService.currentBattle.attackingPet.id && this.battleService.currentBattle.defendingPet.id && !this.battleService.currentBattle.battleFinished">
							<h4 *ngIf="this.battleService.currentBattle.battleLogs.length == 0">Waiting for {{ this.battleService.currentBattle.currentTurnPet.name }} to make the first move!</h4>
							<hr />
							<div *ngFor="let battleLog of this.battleService.currentBattle.battleLogs; let i = index">
								<br *ngIf="i > this.battleService.currentBattle.battleLogs.length - 3" />
								<h4 *ngIf="i > this.battleService.currentBattle.battleLogs.length - 3">{{ battleLog.turnFlavorText }}</h4>
								<br *ngIf="i > this.battleService.currentBattle.battleLogs.length - 3" />
								<hr *ngIf="i > this.battleService.currentBattle.battleLogs.length - 3" />
							</div>
						</div>
						<div *ngIf="this.battleService.currentBattle.battleFinished">
							<hr />
							<br />
							<h4>{{ this.battleService.currentBattle.winningPet.name }} Wins!</h4>
							<br />
							<hr />
						</div>
						<h4>&nbsp;</h4>
					</div>
					<div
						[ngClass]="{ 'col-12 col-md-4 battle-pets bg-dark-fothu rounded': true, 'order-first': this.userService.currentUser.id == this.battleService.currentBattle.defendingUser.id }"
						[ngStyle]="{
							'box-shadow':
								(this.battleService.currentBattle.defendingUser.id == this.battleService.currentBattle.currentTurnPet.owner.id && !this.battleService.currentBattle.battleFinished) || (this.battleService.currentBattle.winningPet.owner.id == this.battleService.currentBattle.defendingUser.id && this.battleService.currentBattle.battleFinished)
									? '0px 0px 70px ' + this.battleService.currentBattle.defendingUser.favoriteColor
									: ''
						}"
					>
						<div *ngIf="!this.battleService.currentBattle.defendingPet.id">
							<div class="petcenter" [ngStyle]="{ visibility: this.battleService.currentBattle.defendingUser.id == this.userService.currentUser.id && !this.battleService.currentBattle.defendingPet.id ? 'hidden' : 'visible' }">
								<br />
								<br />
								<br />
								<h4 class="text-white">{{ this.battleService.currentBattle.defendingUser.username }} is still selecting a pet.</h4>
							</div>
							<div class="petcenter" [ngStyle]="{ visibility: this.battleService.currentBattle.defendingUser.id == this.userService.currentUser.id && !this.battleService.currentBattle.defendingPet.id ? 'visible' : 'hidden' }">
								<br />
								<div class="row">
									<div class="col-12">
										<h4 class="text-white">Select your figher:</h4>
										<br />
										<br />
										<br />
									</div>
									<div class="col-4" *ngFor="let pet of userService.currentUser.pets">
										<button
											[ngClass]="{ 'btn text-white mx-1': true, ' btn-success-fothu bg-success-fothu': (this.battleService.currentBattle.battleType == 'pvp' || pet.currentHealth) > 0, 'btn-light-fothu bg-light-fothu disabled': this.battleService.currentBattle.battleType == 'pve' && pet.currentHealth == 0 }"
											(click)="this.battleService.setDefendingPVPPet(this.battleService.currentBattle.id, pet.id)"
										>
											{{ pet.name }}
										</button>
									</div>
									<br />
									<br />
									<br />
								</div>
							</div>
						</div>
						<div *ngIf="this.battleService.currentBattle.defendingPet.id">
							<br />
							<h4 class="text-white">{{ this.battleService.currentBattle.defendingPet.name }}</h4>
							<br />
							<div class="d-none d-xl-block">
								<div [ngClass]="['big-pet-background img-responsive center-block mx-auto petcenter', this.battleService.currentBattle.defendingUser.favoriteColor]">
									<img class="big-pet-image" [src]="this.battleService.currentBattle.defendingPet.image.imageURL" [alt]="this.battleService.currentBattle.defendingPet.name" />
								</div>
							</div>
							<div class="d-block d-xl-none">
								<div [ngClass]="['medium-pet-background img-responsive center-block mx-auto petcenter', this.battleService.currentBattle.defendingUser.favoriteColor]">
									<img class="medium-pet-image" [src]="this.battleService.currentBattle.defendingPet.image.imageURL" [alt]="this.battleService.currentBattle.defendingPet.name" />
								</div>
							</div>
							<div class="d-none d-xl-block">
								<div class="progress border border-dark wrapper big-pet-battle-health-bar mx-auto">
									<div
										[class]="userService.getHealthBarColor(((this.battleService.currentBattle.defendingPetCurrentHealth / this.battleService.currentBattle.defendingPet.maxHealth) * 100).toFixed(0))"
										[ngStyle]="{ width: ((this.battleService.currentBattle.defendingPetCurrentHealth / this.battleService.currentBattle.defendingPet.maxHealth) * 100).toFixed(0) + '%', 'font-size': 'small', color: 'black', height: '50px' }"
									></div>
									<h4 class="big-data" [ngStyle]="{ visibility: this.battleService.currentBattle.defendingUser.id == this.userService.currentUser.id ? 'visible' : 'hidden' }">{{ this.battleService.currentBattle.defendingPetCurrentHealth }}/{{ this.battleService.currentBattle.defendingPet.maxHealth }} HP</h4>
								</div>
							</div>
							<div class="d-block d-xl-none">
								<div class="progress border border-dark wrapper medium-pet-battle-health-bar mx-auto">
									<div
										[class]="userService.getHealthBarColor(((this.battleService.currentBattle.defendingPetCurrentHealth / this.battleService.currentBattle.defendingPet.maxHealth) * 100).toFixed(0))"
										[ngStyle]="{ width: ((this.battleService.currentBattle.defendingPetCurrentHealth / this.battleService.currentBattle.defendingPet.maxHealth) * 100).toFixed(0) + '%', 'font-size': 'small', color: 'black', height: '50px' }"
									></div>
									<h4 class="big-data" [ngStyle]="{ visibility: this.battleService.currentBattle.defendingUser.id == this.userService.currentUser.id ? 'visible' : 'hidden' }">{{ this.battleService.currentBattle.defendingPetCurrentHealth }}/{{ this.battleService.currentBattle.defendingPet.maxHealth }} HP</h4>
								</div>
							</div>
							<br />
							<div class="action-buttons" [ngStyle]="{ visibility: this.battleService.currentBattle.defendingUser.id == this.userService.currentUser.id && this.battleService.currentBattle.currentTurnPet.id == this.battleService.currentBattle.defendingPet.id ? 'visible' : 'hidden' }">
								<div class="btn-group-vertical btn-group-lg m-1">
									<button class="btn btn-secondary-fothu bg-secondary-fothu battle-button text-white m-1" (click)="this.battleService.attack(this.battleService.currentBattle.id, this.battleService.currentBattle.defendingPet.id)">Attack</button>
									<button class="btn btn-primary battle-button m-1" (click)="this.battleService.aim(this.battleService.currentBattle.id, this.battleService.currentBattle.defendingPet.id)">Aim</button>
								</div>
								<div class="btn-group-vertical btn-group-lg m-1">
									<button class="btn btn-danger battle-button text-white m-1" (click)="this.battleService.defend(this.battleService.currentBattle.id, this.battleService.currentBattle.defendingPet.id)">Defend</button>
									<button class="btn btn-success battle-button m-1" (click)="this.battleService.sharpen(this.battleService.currentBattle.id, this.battleService.currentBattle.defendingPet.id)">Sharpen</button>
								</div>
							</div>
							<br />
							<div class="row" [ngStyle]="{ visibility: this.battleService.currentBattle.defendingUser.id == this.userService.currentUser.id ? 'visible' : 'hidden' }">
								<div class="col-4 text-white">Armor</div>
								<div class="col-4 text-white">Accuracy</div>
								<div class="col-4 text-white">Attack</div>
							</div>
							<div class="row" [ngStyle]="{ visibility: this.battleService.currentBattle.defendingUser.id == this.userService.currentUser.id ? 'visible' : 'hidden' }">
								<div class="col-4 text-white">{{ this.battleService.currentBattle.defendingPetCurrentArmorModifier }}x</div>
								<div class="col-4 text-white">{{ this.battleService.currentBattle.defendingPetCurrentAccuracyModifier }}x</div>
								<div class="col-4 text-white">{{ this.battleService.currentBattle.defendingPetCurrentAttackModifier }}x</div>
							</div>
							<br />
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="col-12 petcenter">
			<br />
			<br />
			<br />
			<br />
			<br />
			<br />
			<button *ngIf="this.battleService.currentBattle.battleType.toLowerCase() == 'pvp'" class="btn btn-success-fothu bg-success-fothu text-white" (click)="this.battleService.closePVPBattle()">Close Battle</button>
			<button *ngIf="this.battleService.currentBattle.battleType.toLowerCase() == 'pve' && this.battleService.currentBattle.battleFinished && this.battleService.currentBattle.attackingPet.currentHealth > 0">Victory!</button>
			<button *ngIf="this.battleService.currentBattle.battleType.toLowerCase() == 'pve' && this.battleService.currentBattle.battleFinished && this.battleService.currentBattle.attackingPet.currentHealth == 0" (click)="this.battleService.createPVEBattle(this.userService.currentUser.id, this.battleService.currentBattle.defendingPet.id)">Select Another Fighter</button>
			<button *ngIf="this.battleService.currentBattle.battleType.toLowerCase() == 'pve' && this.battleService.currentBattle.battleFinished && this.userService.allPetsDead()">No More Pets. Run!</button>
		</div>
	</div>
</div>
